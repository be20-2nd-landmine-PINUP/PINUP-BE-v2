<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì›”ê°„ ë­í‚¹ | PIN-UP</title>
    <style>
        * { box-sizing: border-box; }
        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Pretendard", sans-serif;
            display: flex;
            background: #e5e5e5;
        }

        /* ì‚¬ì´ë“œë°” */
        .sidebar {
            width: 260px;
            min-height: 100vh;
            background: linear-gradient(180deg, #0d6efd, #0052ff);
            color: #fff;
            padding: 24px 20px;
            display: flex;
            flex-direction: column;
        }
        .sidebar-title {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 40px;
        }
        .nav-item {
            display: flex;
            align-items: center;
            padding: 10px 16px;
            border-radius: 999px;
            margin-bottom: 8px;
            cursor: pointer;
            opacity: 0.85;
        }
        .nav-item.active {
            background: rgba(255,255,255,0.25);
            opacity: 1;
        }
        .nav-item span {
            margin-left: 6px;
        }

        /* ë©”ì¸ ì˜ì—­ */
        .main {
            flex: 1;
            padding: 32px 40px;
        }
        .panel {
            background: #f9fbff;
            border-radius: 28px;
            padding: 32px 40px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.05);
            height: calc(100vh - 64px);
            display: flex;
            flex-direction: column;
        }
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        .panel-header-left {
            font-size: 20px;
            font-weight: 600;
        }
        .panel-header-left span.emoji {
            margin-right: 8px;
        }

        /* ì—°ì›” ì„ íƒ */
        .month-box {
            display: inline-flex;
            align-items: center;
            background: #ffffff;
            border-radius: 999px;
            padding: 6px 18px;
            box-shadow: 0 6px 16px rgba(0,0,0,0.08);
            gap: 12px;
        }
        .month-box input[type="month"] {
            border: none;
            outline: none;
            background: transparent;
            font-size: 14px;
            cursor: pointer;
        }
        .month-box button {
            border: none;
            background: #0d6efd;
            color: #fff;
            font-size: 13px;
            padding: 6px 14px;
            border-radius: 999px;
            cursor: pointer;
        }

        .content-row {
            display: grid;
            grid-template-columns: 3fr 1.5fr;
            gap: 24px;
            flex: 1;
        }

        /* ë­í‚¹ í…Œì´ë¸” ì¹´ë“œ */
        .table-card {
            background: #ffffff;
            border-radius: 18px;
            padding: 24px;
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
        }
        thead {
            background: #f3f5ff;
        }
        thead th {
            padding: 10px 8px;
            font-weight: 600;
        }
        tbody tr {
            border-bottom: 1px solid #f0f0f0;
        }
        tbody td {
            padding: 9px 8px;
            text-align: center;
        }
        tbody tr:nth-child(odd) { background: #ffffff; }
        tbody tr:nth-child(even) { background: #fbfbff; }

        /* ë‚´ ë­í‚¹ ì¹´ë“œ */
        .my-rank-card {
            background: linear-gradient(135deg, #007bff, #12c2e9, #4facfe);
            border-radius: 24px;
            padding: 24px;
            color: #fff;
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }
        .my-rank-title {
            font-size: 16px;
            margin-bottom: 8px;
        }
        .my-rank-main {
            font-size: 26px;
            font-weight: 700;
        }
        .my-rank-sub {
            margin-top: 10px;
            font-size: 14px;
            opacity: 0.9;
        }

        .empty-text {
            margin-top: 20px;
            font-size: 14px;
            color: #999;
            text-align: center;
        }
    </style>
</head>
<body>
<!-- ì™¼ìª½ ì‚¬ì´ë“œë°” -->
<aside class="sidebar">
    <div class="sidebar-title">PIN-UP</div>
    <div class="nav-item"><span>â—</span><span>í™ˆ</span></div>
    <div class="nav-item"><span>â—</span><span>ë§ˆì´í˜ì´ì§€</span></div>
    <div class="nav-item"><span>â—</span><span>ë‚´ í”¼ë“œ</span></div>
    <div class="nav-item"><span>â—</span><span>ìƒì </span></div>
    <div class="nav-item"><span>â—</span><span>ì•Œë¦¼</span></div>
    <div class="nav-item"><span>â—</span><span>ì„¤ì •</span></div>
    <div class="nav-item active"><span>â—</span><span>ë­í‚¹</span></div>
</aside>

<!-- ì˜¤ë¥¸ìª½ ë©”ì¸ -->
<main class="main">
    <section class="panel">
        <!-- ìƒë‹¨ íƒ€ì´í‹€ + ì›” ì„ íƒ -->
        <div class="panel-header">
            <div class="panel-header-left">
                <span class="emoji">ğŸ†</span>
                <span>ì›”ê°„ ë­í‚¹ TOP 100</span>
            </div>
            <div class="month-box">
                <input type="month" id="monthInput">
                <button id="applyBtn">ì ìš©</button>
            </div>
        </div>

        <!-- ì•„ë˜: ë­í‚¹ í…Œì´ë¸” + ë‚´ ë­í‚¹ ì¹´ë“œ -->
        <div class="content-row">
            <!-- ë­í‚¹ í…Œì´ë¸” -->
            <div class="table-card">
                <table>
                    <thead>
                    <tr>
                        <th>ìˆœìœ„</th>
                        <th>ë‹‰ë„¤ì„</th>
                        <th>ì •ë³µì§€ì—­ ìˆ˜</th>
                        <th>ë§ˆì§€ë§‰ ì •ë³µì¼</th>
                    </tr>
                    </thead>
                    <tbody id="rankBody">
                    <!-- JSë¡œ ì±„ì›€ -->
                    </tbody>
                </table>
                <div id="rankEmpty" class="empty-text" style="display:none;">
                    ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.
                </div>
            </div>

            <!-- ë‚´ ë­í‚¹ ì¹´ë“œ -->
            <div class="my-rank-card" id="myRankCard">
                <div class="my-rank-title">ë‚˜ì˜ ë­í‚¹ ğŸ†</div>
                <div class="my-rank-main">ë¡œë”© ì¤‘...</div>
                <div class="my-rank-sub" id="myRankSub"></div>
            </div>
        </div>
    </section>
</main>

<script>
    // â˜… ì‹¤ì œ ë¡œê·¸ì¸ ì—°ë™ë˜ë©´, ì—¬ê¸°ëŠ” ì„œë²„ì—ì„œ userIdë¥¼ ë‚´ë ¤ì£¼ê±°ë‚˜
    //   JSì—ì„œ ì¿ í‚¤/ì„¸ì…˜ìœ¼ë¡œ ê°€ì ¸ì˜¤ë„ë¡ ë³€ê²½í•˜ì„¸ìš”.
    const USER_ID = 1;

    document.addEventListener("DOMContentLoaded", () => {
        const monthInput = document.getElementById("monthInput");
        const applyBtn = document.getElementById("applyBtn");

        // ê¸°ë³¸ê°’: ì´ë²ˆ ë‹¬
        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, "0");
        monthInput.value = `${yyyy}-${mm}`;

        // ì²« ë¡œë”©
        loadRanking(yyyy, Number(mm));

        applyBtn.addEventListener("click", () => {
            if (!monthInput.value) return;
            const [y, m] = monthInput.value.split("-");
            loadRanking(Number(y), Number(m));
        });
    });

    // Instant â†’ "YYYY-MM-DD" ë¡œ í‘œì‹œ
    function formatDate(instantString) {
        if (!instantString) return "-";
        const d = new Date(instantString);
        if (isNaN(d.getTime())) return "-";
        const y = d.getFullYear();
        const m = String(d.getMonth() + 1).padStart(2, "0");
        const day = String(d.getDate()).padStart(2, "0");
        return `${y}-${m}-${day}`;
    }

    async function loadRanking(year, month) {
        const rankBody = document.getElementById("rankBody");
        const rankEmpty = document.getElementById("rankEmpty");
        const myRankCard = document.getElementById("myRankCard");
        const myRankSub = document.getElementById("myRankSub");

        rankBody.innerHTML = `<tr><td colspan="4">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</td></tr>`;
        rankEmpty.style.display = "none";

        try {
            // 1) TOP100 ë­í‚¹ ì¡°íšŒ
            const res = await fetch(`/ranks/monthly?year=${year}&month=${month}`);
            const list = await res.json();

            if (!Array.isArray(list) || list.length === 0) {
                rankBody.innerHTML = "";
                rankEmpty.style.display = "block";
            } else {
                rankBody.innerHTML = list.map((item) => {
                    // MonthlyRankDto í•„ë“œëª… ê·¸ëŒ€ë¡œ ì‚¬ìš©
                    const rank = item.rank;
                    const nickname = item.nickname;
                    const captureCount = item.captureCount ?? 0;
                    const lastCaptureAt = formatDate(item.lastCaptureAt);

                    let rankLabel = `${rank}ìœ„`;
                    if (rank === 1) rankLabel = `1ìœ„ ğŸ¥‡`;
                    else if (rank === 2) rankLabel = `2ìœ„ ğŸ¥ˆ`;
                    else if (rank === 3) rankLabel = `3ìœ„ ğŸ¥‰`;

                    return `
                        <tr>
                            <td>${rankLabel}</td>
                            <td>${nickname}</td>
                            <td>${captureCount}ê°œ</td>
                            <td>${lastCaptureAt}</td>
                        </tr>
                    `;
                }).join("");
            }

            // 2) ë‚´ ë­í‚¹ ì¡°íšŒ
            const myRes = await fetch(`/ranks/monthly/me?year=${year}&month=${month}&userId=${USER_ID}`);
            const my = await myRes.json();

            // MyRankDto: userId, nickname, captureCount, rank, message
            const mainEl = myRankCard.querySelector(".my-rank-main");

            if (my && my.message) {
                // message ì•ˆì— "í˜„ì¬ nìœ„ì…ë‹ˆë‹¤." ë˜ëŠ” "ìˆœìœ„ê¶Œ ë°–ì…ë‹ˆë‹¤." ê°€ ì´ë¯¸ ë“¤ì–´ìˆìŒ
                mainEl.innerText = my.message;
            } else if (my && my.rank != null) {
                mainEl.innerText = `í˜„ì¬ ${my.rank}ìœ„ì…ë‹ˆë‹¤.`;
            } else {
                mainEl.innerText = "ìˆœìœ„ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";
            }

            if (my && my.captureCount != null) {
                myRankSub.innerText = `ì •ë³µì§€ì—­ ìˆ˜: ${my.captureCount}ê°œ`;
            } else {
                myRankSub.innerText = "";
            }

        } catch (e) {
            console.error(e);
            rankBody.innerHTML = `<tr><td colspan="4">ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</td></tr>`;
            myRankCard.querySelector(".my-rank-main").innerText = "ë‚´ ë­í‚¹ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆì–´ìš” ğŸ˜¢";
            myRankSub.innerText = "";
        }
    }
</script>
</body>
</html>
